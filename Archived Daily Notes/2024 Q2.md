
01/0824
- Suggestion from William:
	- Soft delete for 10 days (after the 90)
	- Separating perms and infra
- Go cp
- Test issue for Ibrahim

29/07/24
- audit policy module

25/07/24
- Cleaning up monitoring PR's
- PD

Company meeting noteS:
- Project creation is normally a fairly involved process, by putting the creation of projects into code, we can ensure that the right controls are being implemented, and the projects are being created the same every time. Doing this manually introduces more capacity for human error​
    
- EXAMPLE: Alto works with both our own projects and as a bring your own environment, we will be creating customer projects using this automation to test alto with simulated BYO envs​
    
- By silo-ing customer & internal projects into separate GCP projects, we can better track cost 'at-a-glance'​
- Mon

24/07/24

23/07/24


22/07/24
- With the dummy command working, get the fields working as intended, prettify further
- Can we summarise these events even further? 3 key fields, then link to the kelLOG
- 


19/07/24
- Get exclusion working & explore difference between error logs and console
- Python tinkering
- Helping Riccha
- PD

18/07/24
- Riccha dev VM troubleshooting
- Python and terraform finagling to get exclusions working
- Meetings
- 

17/07/24
- Deploy new function to use latest code
- Testing exclusion

16/07/24
- Apply Tower YAML
- Fabio VM moves

15/07/24
- YAML for Kobold Tower
- Jamie VM's moves
- Fixing SA TF new projects
- 


12/07/24
- YAML for Kobold Tower
- Fix TF - Kobold bucket lifecycle
- Prep customer meeting
- 

11/07/24
- new project
- YAML for new workspace etc.
- Confirming assertions about docs
- PR for AWS

10/07/24
- Move Jamie project to CC
- Move Fabio and others who are in
- Kobold PR
- SLIDES - mention alto

09/07/24
- Move Jamie VM, troubleshooting for him
- Removing AWS JSON policy
- Meetings (3hr)
- Create kobold project

09/07/24
- Testing script and making bash version to compare speed
- Improvements to script, testing on VM's
- Pick up python for monitoring again

08/07/24
- Catching up
- VM mover script test

06/07/24
- VM mover test script finish
- 

28/06/24
- Vm mover script finish
- PD

27/06/24
- Create Project migration tooling epic
	- Auto lifecycle for newly created buckets?
	- VM Mover script
	- TF for new VM
	- Fun things with SeqeraKit - automation
- Tickets for https://cegx.atlassian.net/browse/PE-1325
- Catch up Ken & Harry
- Catch up Max
- VM Mover script
- 

26/06/24
- Computational teams work is tracked in dedicated projects
	- End goal - all runs done through CLI or alto - reduce
- Moving Jean VM and additional disks
- 

25/06/24
- Slack Python API in 
	- https://cloud.google.com/functions/docs/tutorials/pubsub
- Moving VM for Jean

24/06/24
- Ticket pruning
- CC project & whip-cracking
- Look into backend x-plat
- Retry for Azure
- python of 

21/06/24
- New CC project
- Message DS & CC individually
- slurm module
- PD

20/06/24
- coda alpha release tag issue - particular poetry
- slurm modules

19/06/2024
- TF permission wrangling
- new biomodal modules on the slurm cluster
- Log hunting

18/06/24
- Fix bs2gcp transfer SA permissions
- 

17/06/24
- vscode python env wrangling
- Python error handling
- Get function working again
	- Using slack? Auth needs fixing anyway
	- 

14/06/24
- Finagling python
- Production readify terraform
- Help Ibrahim
- Project ilmn

13/06/24
- Error logging terraform
- meetings 3hrs
- Gery help

12/06/24
Full day planning stuff 

11/06/24
- Cross plat
- TF + python PoC for error logging

10/06/24

07/06/24
- Azure cross-platform fix
- security terraform
- 

06/05/24
- Ibrahim help
- Tracking x-plat
- Monitoring terraform
	- biomodal-app
	- security
- 

05/06/24
- Setting up new laptop
- Cross-platform fix
- New refs
- 


04/06/24
- into the weeds a bit looking at terraform import + tfstate
- Created new repo and started making TF for cegx-releases alerts not in IaC
- Customer support call and small look at the issue w/Ibrahim
- X-plat issues:
```
Local: Copying /home/nathan_admin_cegx_co_uk/Ptrichocarpa_v4-1.config to /biomodal/data_bucket/reference_files
/test/Ptrichocarpa_v4-1.config                                                                                
cp: cannot create regular file '/biomodal/data_bucket/reference_files/test/Ptrichocarpa_v4-1.config': No such 
file or directory 
```
Expectrs file there, but is in /biomodoal

03/06/24
- TF to switch slack channel
- import state after change
- Start on creating TF for cegx-releases monitoring
- Q2Z dep update
- Timely backlog
- PR reviews
- 

31/05/24
- Fix slurm?
- Fix PR for Tower slack channel change

30/05/24
- Separate existing alerts into respective channels in TF
- See how much can be done with existing tools
	- When testing, use a positive uptime check
- Finish make ref testing
- 

29/05/24
- Improve error reporting through Slack
	- V1:
		- 2 new app channels
		- Separate out existing notifications accordingly
			- Do this in terraform
	- V2:
		- Depending on how these logs look, may want to make a 'mini-API' similar to Étiennes work
		- Likely more extensible than doing it purely on Terraform 
	- Tasks in order:
		- Make Slack apps - infra & app monitoring
			- Save details in keeper
		- Move existing infra alerts for Tower to infra monitoring channel
		- Look at categorisation for apps:
			- api/ dev/ app?
			- requestUrl contains the bundle e.g. basespace_transfer
			- For example, if it's generating a 500, why was that caused?
- Start port of x-plat make ref to all execs

28/05/24
- Update cluster -  Java & Nextflow
- GCP Batch make_ref x-plat test
- Update and merge azure storage prefix PR- 

23/05/24
- az prefix PR
- GCP Batch reference 

22/05/24
- validate validate
- Review PR issues and Kens PR
- Switch az:// to https://

21/05/2024
- Bug fix testing
- Azure fix
- compute envs
- start on validate validate

20/05/24
- info PR
- Azure issues & spending
- Bug fix

17/05/24
- info PR & test on local
- Azure issues
- Bug fix

15/05/24
- HPC biomodal info

08/05/24
- 

07/05/24
- azure validate
	- all working except when a trailing / isn't left on the input-path

03/05/24
- azure validate
	- meta, input and output checked
	- TODO:
		- Fix work-dir validate, uses azure blob command
		- Check tag
		- Check metafile fields not working?

02/05/24
- merge Azure x-plat PR
- Azure validate commands
- cloud logging

01/05/24
- Azure testing
- Logging
- input val

30/04/2024
- Rao lab data copy
- Azure testing
- 

26/04/24
- Slurm upgrade ticket
- Rao lab project & data
	- Once data has been moved make old bucket read-only

25/04/24
- Azure - azcopy of tar.gz not copying
- Done  - az ticket
- Ticket I didn't write....?

24/04/24
- Merge backends PR
- Rao lab project and data move
- Azure x-platform testing & changes
- DS help with using their project
- 


23/04/24
- Add backends for all clouds - test
- Azure:
	- Add more variables to allow only minimum creation of resources
	- Add auth for existing storage container to allow pushing
	- Find solution or workaround for HTTP issue

22/04/24
- Final changes to x-plat PR and merge
- Azure run - new container being made in nextflowtower storage account, stop this
	- Had to delete everything manually again as state got manky
- slurm placement policies/ how to get this damn thing running reliably
- Create new nextflow app dir and set biomodal/latest to use that instead
- 1HR PD

19/04/24
- 

18/04/2024

PE-710
- Separate run_all script `run_slurm`
- Adapt script to take branch name
-  Remove biomodal test + send metrics/ web hook§1
- 

PE-711
- do same as above for local
- Update docs with step-by-step instructions
### PE Sprint 105
- Fix Q2Z container:
	- https://hub.docker.com/r/mambaorg/micromamba
	- https://stackoverflow.com/questions/76884520/cloning-environment-with-micromamba
	- https://stackoverflow.com/questions/75048777/moving-existing-mamba-conda-environments-to-micromamba
	- https://www.anaconda.com/blog/moving-conda-environments
- Write epic on HPC development testing - confer with Ken

12/04/2024 AM
- Test alternate azcopy login

11/04/2024
- Azure - reproduce Ken issue
- Test AZ fix, permissions problem
- 

10/04/2024
- 
- go cli gcp copy

09/04/2024
- biomodal data download instructions
- Help Ibrahim
- Go CLI
- Modality licenses PR
- 
08/04/2024
- DS - python run on 

05/04/2024
- hot-fix branch - 

04/04/2024
- Troubleshooting Q2Z container on AWS, test on local
- az copy login
- 

03/04/2024
- Destroy cluster
- Running container on Azure
- 

02/04/2024
Container fix
Test error outputs
Resize slurm

28/03/2024
- Add per option error messages
- Conda fixing
	- Get package list from modality, check if pruning can be done at that phase
	- Get package list once env has been created in quant2zarr
- 

27/03/2024
~~Reduce slurm~~
feedback from andrada
q2z dep conflict issues

```
CondaPackError: 
Files managed by conda were found to have been deleted/overwritten in the
following packages:

- docutils 0.16:
    lib/python3.11/site-packages/docutils-0.16.dist-info/COPYING.txt
    lib/python3.11/site-packages/docutils-0.16.dist-info/INSTALLER
    lib/python3.11/site-packages/docutils-0.16.dist-info/METADATA
    + 7 others
- brotli-python 1.0.9:
    lib/python3.11/site-packages/Brotli-1.0.9.dist-info/INSTALLER
    lib/python3.11/site-packages/Brotli-1.0.9.dist-info/LICENSE
    lib/python3.11/site-packages/Brotli-1.0.9.dist-info/METADATA
    + 5 others

This is usually due to `pip` uninstalling or clobbering conda managed files,
resulting in an inconsistent environment. Please check your environment for
conda/pip conflicts using `conda list`, and fix the environment by ensuring
only one version of each package is installed (conda preferred).
```


26/03/2024
biomodal-data download final touches testing
AWS issue




20/03/2024
- Done:
	- more error verbosity
	- single sample 
- GIAB download script
	- rsync --partial not a thing
	- Didn't work due to `|| -z cmd`  hadn't been removed but the flag had
	- rsync command produces an error, currently unsure why, `cp` resumes downloads though, so presumably acceptable
TODO
- Figure out which switches are optional and which are mandatory
	- Mandatory - all of them?
	- Optional:
- Implement the right logic for those switches, including in some cases a default option for the optional switches
- Make sure the switches are described properly in the `usage()` output and that the user gets a useful message if they specify the switches incorrectly
- Ensure both 5bp and 6bp downloads point to the appropriate location on the bucket
- We were planning to restrict the download to a single sample, in line with @Ken Haug 's `--lib_prefix` comment below - I guess this would need to add an appropriate substring match to the `gcloud storage rsync` command both for 5bp and 6bp
- Test test test!
Issues:
- No raw-fastq for 6L
- This is exceptionally brittle should changes be made to the bucket

- Improvements:
	- Re-org bucket and rename so that it's less biomodal specific? At least re-org so that it's less brittle/ use more advanced programming to find files we're looking for. Could be a PITA in bash.
	- raw-fastq for evoC

### PE Sprint 104



19/03/2024
- Helping with Q2Z debug
- GIAB download
	- https://cegx.atlassian.net/browse/PE-496
- 

18/03/2024
- CLI labels

PE-496 
- Test run function normally
- Test lib_prefix
- Code is in 
